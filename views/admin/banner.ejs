<%- include('head.ejs') %>
    
        <div class="productsNav mt-3 mb-5">
            <div class="searchBar">
                <input type="search" placeholder="Search for products by name or category" id="productSearch">
                <i class="las la-search"></i>
            </div>
            <button class="btn btn-success" id="openAddProduct">Add Banner</button>
            
        </div>
    
    <div class="div tableWrapper">
        <table class="table table-light">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <!-- <th scope="col">Profile</th> -->
                    <th scope="col">Matter</th>
                    <th scope="col">Image</th>
                    <!-- <th scope="col">Phone</th> -->
                    <th scope="col">Category</th>
                   
                    <!-- <th scope="col">edit</th> -->
                    <th scope="col">delete</th>
                    
                </tr>
            </thead>
            <% if(error) { %>
                <h4>error</h4>
                <% }else { %>
            <tbody>
                <% banners.map((baner, index)=> { %>
                    <tr class="product-row">
                        <th scope="row">
                            <%= index + 1 %>
                        </th>
                        <!-- <td><img src="/assets/images/icons/logo.png"
                                style="width: 40px;height: 40px;object-fit: cover;border-radius: 10px;"></td> -->
                        <td class="user-name">
                            <%= baner.matter %>
                        </td>

                        <td>
                            <img src="<%= baner.ImagePath[0] %>"
                                    style="width: 40px;height: 40px;object-fit: cover;border-radius: 10px;">
                        </td>

                       
                        <td>
                            <%= baner.catagory %>
                        </td>
                        <td>
                            <a href="/admin/deletebanner/<%= baner._id %>" class="btn btn-danger delete-button"
                                onclick="return confirm('Are you sure you want to delete this catagory?')">Delete</a>
                        </td>
                        
                    </tr>
                    <% }); %>
            </tbody>
            <% } %>
        </table>
    </div>
    <div class="popUp" style="display: none;">
        <div><button class="btn btn-danger closeBtn">close</button></div>
        <div class="formDiv">
            <h6 class="text-center">Add New Banner</h6>
            <form action="/admin/addbanner" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label">Matter</label>
                    <input type="text" class="form-control" id="fileUpload" name="matter" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Category</label>
                    <select class="form-label form-control" name="catagory">
                        <% ctgry.map((category, index)=> { %>
                            <option value="<%= category.catagory %>" class=""><%= category.catagory %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Select the images</label>
                    <input type="file" class="form-control" id="fileUpload" name="images" value="" multiple>
                </div>
                <div id="imagePreview"></div>
                <button type="submit" class="btn btn-primary">Add Catagory</button>
            </form>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            // Select the search input field
            const productSearchInput = document.getElementById('userSearch');

            // Select all product rows
            const productRows = document.querySelectorAll('.product-row');

            productSearchInput.addEventListener('input', () => {
                const searchTerm = productSearchInput.value.toLowerCase();

                // Loop through all product rows and hide those that don't match the search term
                productRows.forEach((row) => {
                    const productName = row.querySelector('.user-name').textContent.toLowerCase();
                    const productCategory = row.querySelector('.user-email').textContent.toLowerCase();

                    if (
                        productName.includes(searchTerm) ||
                        productCategory.includes(searchTerm)
                    ) {
                        row.style.display = 'table-row';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });

        })
    </script>

    <script>
        $(document).ready(() => {
            $("#openAddProduct").click(() => {
                $(".popUp").toggle(300);
            })
            $(".closeBtn").click(() => {
                $(".popUp").toggle(300);
            })
        })
    </script>

<script>
    const fileInput = document.getElementById('fileUpload');
    const imagePreview = document.getElementById('imagePreview');
    let selectedFiles = [];

    fileInput.addEventListener('change', () => {
        imagePreview.innerHTML = '';
        const files = fileInput.files;

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.className = 'preview-image';
                img.src = URL.createObjectURL(file);
                img.setAttribute('data-index', i);

                img.addEventListener('click', (event) => {
                    const index = parseInt(event.target.getAttribute('data-index'));
                    selectedFiles = selectedFiles.filter((_, idx) => idx !== index);
                    updateFileInput(selectedFiles);
                    img.remove();
                });

                img.addEventListener('mouseover', () => {
                    img.style.opacity = '0.5';
                });

                img.addEventListener('mouseout', () => {
                    img.style.opacity = '1';
                });

                imagePreview.appendChild(img);
                selectedFiles.push(file);
            }
        }
        updateFileInput(selectedFiles);
    });

    function updateFileInput(updatedFiles) {
        const updatedFileList = new DataTransfer();
        for (let i = 0; i < updatedFiles.length; i++) {
            updatedFileList.items.add(updatedFiles[i]);
        }
        fileInput.files = updatedFileList.files;
    }

</script>
    <%- include('foot.ejs') %>